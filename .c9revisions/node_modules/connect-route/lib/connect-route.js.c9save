{"ts":1355922726457,"silentsave":true,"restoring":false,"patch":[[{"diffs":[[1,"(function () {\n\t'use strict';\n\tvar\n\t\tmethods = [ 'get', 'post', 'put', 'delete', 'connect', 'options', 'trace', 'copy', 'lock', 'mkcol', 'move', 'propfind', 'proppatch', 'unlock', 'report', 'mkactivity', 'checkout', 'merge' ],\n\t\tseparator = /^[\\s\\/]+|[\\s\\/]+$/g,\n\t\ti, length,\n\n\t\tcreateMethodHandler = function (method) {\n\t\t\tmethod = method.toUpperCase();\n\t\t\treturn function () {\n\t\t\t\tvar i;\n\t\t\t\tfor (i = 0; i < arguments.length - 1; i++) {\n\t\t\t\t\tthis.add(method, arguments[i], arguments[arguments.length - 1]);\n\t\t\t\t}\n\t\t\t};\n\t\t},\n\n\t\tRouter = function () {\n\t\t\tthis.routes = {};\n\t\t};\n\n\tRouter.prototype.add = function (method, route, handler) {\n\t\tvar\tparts, current, i, length, name;\n\n\t\tif (typeof handler !== 'function') { return; }\n\t\tif (!this.routes[method]) { this.routes[method] = { childs: {}, handler: undefined, route: undefined }; }\n\n\t\tparts = route.split('?', 1)[0].replace(separator, '').split('/');\n\n\t\tif (!parts[0].length) {\n\t\t\tthis.routes[method].handler = handler;\n\t\t\tthis.routes[method].route = route;\n\t\t} else {\n\t\t\tcurrent = this.routes[method];\n\t\t\tfor (i = 0, length = parts.length; i < length; i++) {\n\t\t\t\tname = undefined;\n\t\t\t\tif (parts[i].charAt(0) === ':') {\n\t\t\t\t\tname = parts[i].substr(1);\n\t\t\t\t\tparts[i] = '*';\n\t\t\t\t}\n\t\t\t\tif ((!current.childs[parts[i]] && (current.childs[parts[i]] = {})) || (parts[i] === '*' && !current.childs[parts[i]][length])) {\n\t\t\t\t\tif (parts[i] === '*') {\n\t\t\t\t\t\tcurrent.childs[parts[i]][length] = { handler: undefined, route: undefined, childs: {}, name: name };\n\t\t\t\t\t} else {\n\t\t\t\t\t\tcurrent.childs[parts[i]] = { handler: undefined, route: undefined, childs: {}, name: name };\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (parts[i] === '*') {\n\t\t\t\t\tcurrent = current.childs[parts[i]][length];\n\t\t\t\t} else {\n\t\t\t\t\tcurrent = current.childs[parts[i]];\n\t\t\t\t}\n\t\t\t}\n\t\t\tcurrent.handler = handler;\n\t\t\tcurrent.route = route;\n\t\t}\n\t};\n\n\tRouter.prototype.match = function (method, url) {\n\t\tvar\n\t\t\tparts = decodeURI(url).split('?', 1)[0].replace(separator, '').split('/'),\n\t\t\tresult = { handler: undefined, route: undefined, params: {} },\n\t\t\tcurrent, i, length;\n\n\t\tif (this.routes[method]) {\n\t\t\tif (!parts[0].length) {\n\t\t\t\tresult.handler = this.routes[method].handler;\n\t\t\t\tresult.route = this.routes[method].route;\n\t\t\t} else {\n\t\t\t\tcurrent = this.routes[method];\n\t\t\t\tfor (i = 0, length = parts.length; i < length; i++) {\n\t\t\t\t\tif (current.childs[parts[i]]) {\n\t\t\t\t\t\tcurrent = current.childs[parts[i]];\n\t\t\t\t\t\tresult.handler = current.handler;\n\t\t\t\t\t\tresult.route = current.route;\n\t\t\t\t\t} else if (current.childs['*'] && current.childs['*'][length]) {\n\t\t\t\t\t\tcurrent = current.childs['*'][length];\n\t\t\t\t\t\tresult.handler = current.handler;\n\t\t\t\t\t\tresult.route = current.route;\n\t\t\t\t\t\tresult.params[current.name] = parts[i];\n\t\t\t\t\t} else {\n\t\t\t\t\t\tresult.handler = undefined;\n\t\t\t\t\t\tresult.route = undefined;\n\t\t\t\t\t\tresult.params = {};\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn result;\n\t};\n\n\tfor (i = 0, length = methods.length; i < length; i++) {\n\t\tRouter.prototype[methods[i]] = createMethodHandler(methods[i]);\n\t}\n\n\tmodule.exports = function (cb) {\n\t\tvar router = new Router();\n\t\tif (typeof cb === 'function') { cb(router); }\n\n\t\treturn function (req, res, next) {\n\t\t\tvar action = router.match(req.method, req.url);\n\t\t\tif (action.handler) {\n\t\t\t\treq.route = action.route;\n\t\t\t\treq.params = action.params;\n\t\t\t\taction.handler(req, res, next);\n\t\t\t} else {\n\t\t\t\treq.route = undefined;\n\t\t\t\treq.params = {};\n\t\t\t\tnext();\n\t\t\t}\n\t\t};\n\t};\n}());"]],"start1":0,"start2":0,"length1":0,"length2":3413}]],"length":3413}
